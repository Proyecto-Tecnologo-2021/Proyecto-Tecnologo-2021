<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" lang="sp">
	
	
	<p:remoteCommand name="rc"
		action="#{beanUserLoged.getRestauranteReg()}" update="userProfileName userProfileImg" />


	<p:remoteCommand name="rc2" oncomplete="loadLocalStorage();"
		autoRun="true" />
 	
	<p:remoteCommand name="rds"
		action="#{beanUserLoged.destroySession()}"/>
		
	
	<!-- top header -->
	<div class="top-header py-2 bg-white">
		<div class="container">
			<div class="row no-gutters">
				<div class="col-lg-12 text-right text-lg-right">
					<div class="dropdown show">

						<a class="nav-link text-secondary" id="userDropdown" href="#"
							data-toggle="dropdown">
							<div class="navbar-profile">
								<p class="mb-0 d-sm-block navbar-profile-name"
									id="userProfileData">

									<h:outputText value="#{beanUserLoged.restaurante.nombre }" id="userProfileName"/>
									<p:graphicImage styleClass="img-profile"
										value="#{beanUserLoged.restaurante.imagen.imagen}" id="userProfileImg"/>
								</p>
							</div>
						</a>
						<div
							class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list"
							aria-labelledby="profileDropdown">
							<!-- <h6 class="p-3 mb-0">Perfil</h6> -->
							<div class="dropdown-divider"></div>
							<a href="javascript:clearLocalStorage();"
								class="list-group-item list-group-item-action">Salir</a>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
			var userTOKEN;
			
			function loadinfoFromLocalStorage() {
				//storeLocalStorage();
				loadLocalStorage();
			}
			
            function loadLocalStorage() {
                var prefix = 'react.appetitUser';
                console.log(prefix);
                getLocalStorageValue(prefix);
            }

            function storeLocalStorage(){
            	var prefix = 'react.appetitUser';

            	var contenido = "{\"correo\":\"comoencasa.gf@gmail.com\", \"token\":\"eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiIxIiwicm9sZXMiOlt7ImlkIjoxLCJub21icmUiOiJBZG1pbmlzdHJhZG9yIn1dLCJpYXQiOjE2MjQ1NTQ2MjMsImV4cCI6MTYyNDU1ODIyM30.e5-4eu_JK7s3pN6Pxp2HjJIYsEOgQ2U4OuLYToJ3XGggLTAPlocbo-sYslaSKjiwJtMLVaIfoQ914dFB3E8VXg\",\"nombre\":\"Restaurante Prueba Cookie \",\"rol\":\"restaurante\"}";
            	localStorage.setItem(prefix, contenido);
                
            }

            function clearLocalStorage(prefix) {
            	localStorage.clear();
            	rds();
            }

            function getLocalStorageValue(prefix) {
            	if (localStorage.getItem(prefix)) {
                	console.log(localStorage.getItem(prefix));
                	var prefixValue = JSON.parse(localStorage.getItem(prefix));
                	
                	//prefixValue = JSON.parse(prefixValue);
                 	userTOKEN =  prefixValue["token"];

                    //var n = document.getElementById("userProfileName"); 
                    //n.val(prefixValue["nombre"]);

                    //var n = document.getElementById("userProfileCorreo");
                    //n.append(prefixValue["correo"]);
					
					rc([{name: 'correo', value: prefixValue["correo"]}]);                 
                 
					if(prefixValue["rol"] != 'restaurante'){
						console.log("ERROR ROL RESTAURANTE");
						localStorage.clear();
						window.location.href = "#{beanUserLoged.constantes.REDIRECT_URI}";
	                }

                    
                    
                }else{
                	console.log("ERROR NO COOKIE");
                	window.location.href = "#{beanUserLoged.constantes.REDIRECT_URI}";
				}
            }

            </script>

</ui:composition>
